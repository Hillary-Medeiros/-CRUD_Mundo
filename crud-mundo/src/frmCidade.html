<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Mundo - Cadastro Cidade</title>
    <link rel="stylesheet" href="forms.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="//cdn.jsdelivr.net/npm/globe.gl"></script>
</head>
<body>
    <!-- Fundo de estrelas -->
    <div class="stars"></div>

    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <a href="index.html" style="text-decoration: none;"><h2>Hillary Medeiros</h2></a>
            </div>
            <div class="navbar-menu">
                <a href="frmPais.html" class="nav-link">Cadastrar País</a>
                <div class="dropdown" style="position:relative;">
                    <button class="dropdown-btn" style="padding:8px 12px;">Visualizar ▼</button>
                    <div class="dropdown-content" style="position:absolute; top:100%; left:0; margin-top:8px;">
                        <a href="Visualizar_Paises.html">Países</a>
                        <a href="Visualizar.html">Cidades</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT --> 
    <main class="main-content">
        <div class="hero-section">
            <h1 class="main-title">Cadastrar Cidade</h1>

            <!-- Formulário -->
            <form id="formCidade" class="form-cadastro">
                <div class="form-group">
                    <label for="nome_Cidade">Nome da Cidade</label>
                    <input type="text" id="nome_Cidade" name="nome_Cidade" required placeholder="Digite o nome da cidade">
                </div>

                <div class="form-group">
                    <label for="populacao_Cidade">População</label>
                    <div class="input-group">
                        <button type="button" class="btn-adjust" id="decrease"><i class="bi bi-dash"></i></button>
                        <input type="number" id="populacao_Cidade" name="populacao_Cidade" required placeholder="Ex: 1500000" min="0" step="1" value="0">
                        <button type="button" class="btn-adjust" id="increase"><i class="bi bi-plus"></i></button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="id_Pais">País</label>
                    <select id="id_Pais" name="id_Pais" required>
                        <option value="">Carregando países...</option>
                    </select>
                </div>

                <button type="submit" class="btn-enviar">Cadastrar</button>
            </form>

            <div class="globe-container">
                <div id="globeViz"></div>
            </div>
        </div>
    </main>

    <script type="module" src="main.js"></script>

    <script>
        // Carregar os países
        async function carregarPaises() {
            try {
                const response = await fetch("Cadastrar_Cidade.php?action=paises");
                const paises = await response.json();

                const select = document.getElementById("id_Pais");
                select.innerHTML = '<option value="">Selecione o país</option>';

                paises.forEach(pais => {
                    const option = document.createElement("option");
                    option.value = pais.id_Pais;
                    option.textContent = pais.nome_Pais;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error("Erro ao carregar países:", error);
                const select = document.getElementById("id_Pais");
                select.innerHTML = '<option value="">Erro ao carregar países</option>';
            }
        }

        // enviar formulário pro php
        document.getElementById("formCidade").addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);

            const response = await fetch("Cadastrar_Cidade.php", {
                method: "POST",
                body: formData
            });

            const result = await response.text();
            alert(result);
            e.target.reset();
        });

        // btn + e -
        const input = document.getElementById('populacao_Cidade');
        const increase = document.getElementById('increase');
        const decrease = document.getElementById('decrease');

        increase.addEventListener('click', () => {
            input.value = parseInt(input.value || 0) + 1000;
        });

        decrease.addEventListener('click', () => {
            let value = parseInt(input.value || 0);
            if (value > 0) input.value = value - 1000;
        });

        carregarPaises();
    </script>
</body>
</html>
